---
title: "HW5"
output: github_document
---

## Problem 1
```{r setup, include=FALSE}
library(tidyverse)
library(purrr)
knitr::opts_chunk$set(fig.width=12, fig.height=8)
```

```{r, message=FALSE}

set.seed(10)

iris_with_missing = iris %>% 
  map_df(~replace(.x, sample(1:150, 20), NA)) %>%
  mutate(Species = as.character(Species)) %>% janitor::clean_names()

rep_mis = function(x){
  if(is.character(x)){
    col = replace(x, is.na(x), "virginica")
  }else if(is.numeric(x)){
    col = replace(x, is.na(x), round(mean(x, na.rm = T),1))
  }
  col
}

iris = map(iris_with_missing, rep_mis)
iris_df = data.frame(iris)
knitr::kable(head(iris_df))
```

## Problem 2

```{r, message=FALSE}
df = tibble(subject_id = list.files("./data/"))
read_data = function(x){
  path = str_c("./data/", x)
  data = read_csv(path)
  data
}

df = cbind(df, map(df[[1]], read_data) %>% bind_rows())
df = df %>% separate(subject_id, into = c("arm", "subject_id"), sep = "\\_") %>% separate(subject_id, into = c("subject_id", "delete")) %>% select(-delete)
knitr::kable(df)

df %>% pivot_longer(week_1:week_8, names_to = "week", values_to = "value") %>% mutate(id = str_c(arm, "_" ,subject_id), week = factor(str_remove(week, "week_"))) %>% ggplot(aes(x=week, y = value, group = id)) + geom_line(aes(color = id)) + facet_grid(.~arm) + theme_bw() + theme(legend.position = "bottom", plot.title = element_text(hjust = 0.5), legend.title = element_blank()) + labs(
  title = "Spaghetti Plot (con vs eop)"
) + guides(colour = guide_legend(nrow = 2)) + geom_point(aes(color = id, shape = arm))
```

